(function(){"use strict";var commonmark;var texme={};var options={};texme.setDefaultOptions=function(){options.renderOnLoad=true;options.useMathJax=true;options.protectMath=true;options.style="viewer";options.onRenderPage=undefined;options.externalMarkdownRenderer=undefined;options.commonmarkURL="https://cdnjs.cloudflare.com/ajax/libs/commonmark/0.28.1/commonmark.min.js";options.MathJaxURL="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML"};var setWindowOptions=function(){var key;for(key in options){if(typeof window!=="undefined"&&typeof window.texme!=="undefined"&&typeof window.texme[key]!=="undefined"){options[key]=window.texme[key]}}};texme.setOption=function(key,val){options[key]=val};var loadjs=function(url,callback){var script=window.document.createElement("script");script.src=url;script.onload=callback;window.document.head.appendChild(script)};texme.tokenType={MARK:0,MASK:1};texme.tokenLiteral={MASK:"::MASK::"};var styles={plain:["body {","  color: #333;","}","main {","  max-width: 40em;","  margin-left: auto;","  margin-right: auto;","}","h1, h2, h3, h4, h5, h6, h7 {","  margin-top: 1.2em;","  margin-bottom: 0.5em;","}","a:link, a:visited {","  color: #03c;","  text-decoration: none;","}","a:hover, a:active {","  color: #03f;","  text-decoration: underline;","}","img {","  max-width: 100%;","}","pre, code, samp, kbd {","  font-family: monospace,monospace;","  font-size: 0.9em;","  color: #009;","}","pre code, pre samp, pre kbd {","  font-size: 1em;","}","pre {","  padding: 0.5em;","  overflow: auto;","  background: #eee;","}","blockquote {","  border-left: medium solid #ccc;","  margin-left: 0;","  margin-right: 0;","  padding: 0.5em;","  background: #eee;","}","blockquote *:first-child {","  margin-top: 0;","}","blockquote *:last-child {","  margin-bottom: 0;","}"].join("\n"),viewer:["@media screen and (min-width: 40em) {","  body {","    background: #444;","  }","  main {","    background: #fff;","    padding: 5em 6em;","    margin: 1em auto;","    box-shadow: 0.4em 0.4em 0.4em #222;","  }","}"].join("\n"),none:""};styles.viewer=styles.plain+styles.viewer;texme.tokenize=function(s){var pattern=["\\\\begin{.*}[\\s\\S]*?\\\\end{.*}","\\\\\\[[\\s\\S]*?\\\\\\]","\\\\\\([\\s\\S]*?\\\\\\)","\\\\\\$","\\$\\$(?:[^\\\\]|\\\\.)*?\\$\\$","\\$(?:[^$\\\\]|\\\\.)+?\\$",texme.tokenLiteral.MASK].join("|");var re=new RegExp(pattern,"g");var result;var markdownText;var tokens=[];var nextIndex=0;while((result=re.exec(s))!==null){if(result.index>nextIndex){markdownText=s.substring(nextIndex,result.index);tokens.push([texme.tokenType.MARK,markdownText])}tokens.push([texme.tokenType.MASK,result[0]]);nextIndex=re.lastIndex}markdownText=s.substring(nextIndex);if(s.length>nextIndex){tokens.push([texme.tokenType.MARK,markdownText])}return tokens};texme.mask=function(tokens){var maskedText=[];var maskedTokenValues=[];var tokenType;var tokenValue;var i;for(i=0;i<tokens.length;i++){tokenType=tokens[i][0];tokenValue=tokens[i][1];if(tokenType===texme.tokenType.MARK){maskedText.push(tokenValue)}else{maskedText.push(texme.tokenLiteral.MASK);maskedTokenValues.push(tokenValue)}}return{text:maskedText.join(""),tokenValues:maskedTokenValues}};texme.unmask=function(s,tokens){var re=new RegExp(texme.tokenLiteral.MASK,"g");var i=0;return s.replace(re,function(){return tokens[i++]})};texme.renderCommonMark=function(s){var parsed=(new commonmark.Parser).parse(s);var result=(new commonmark.HtmlRenderer).render(parsed);return result};texme.renderMarkdown=function(s){var renderer=typeof options.externalMarkdownRenderer==="function"?options.externalMarkdownRenderer:texme.renderCommonMark;return renderer(s)};texme.protectMathAndRenderMarkdown=function(s){var tokens=texme.tokenize(s);var masked=texme.mask(tokens);var rendered=texme.renderMarkdown(masked.text);var unmasked=texme.unmask(rendered,masked.tokenValues);return unmasked};texme.render=function(s){if(options.protectMath){return texme.protectMathAndRenderMarkdown(s)}else{return texme.renderMarkdown(s)}};texme.renderPage=function(){var textareaElements=window.document.getElementsByTagName("textarea");var outputElement=window.document.createElement("main");var inputText;var title;if(textareaElements.length>0){inputText=textareaElements[0].value.trim();textareaElements[0].remove()}else{inputText=window.document.body.innerHTML.trim();window.document.body.innerHTML=""}if(typeof window.document.title==="undefined"||window.document.title===""){title=inputText.split("\n",1)[0].replace(/^\s*#*\s*|\s*#*\s*$/g,"");window.document.title=title}window.document.body.appendChild(outputElement);var styleElement=window.document.createElement("style");var css=styles[options.style];styleElement.appendChild(window.document.createTextNode(css));window.document.head.appendChild(styleElement);var metaElement=window.document.createElement("meta");metaElement.name="viewport";metaElement.content="width=device-width; initial-scale=1.0";window.document.head.appendChild(metaElement);outputElement.innerHTML=texme.render(inputText);if(options.useMathJax){window.MathJax.Hub.Queue(["Typeset",window.MathJax.Hub,outputElement])}if(typeof options.onRenderPage!=="undefined"){options.onRenderPage()}};texme.main=function(){texme.setDefaultOptions();if(typeof window!=="undefined"){setWindowOptions();loadjs(options.commonmarkURL,function(){commonmark=window.commonmark});if(options.useMathJax){window.MathJax={tex2jax:{inlineMath:[["$","$"],["\\(","\\)"]],processEscapes:true},TeX:{equationNumbers:{autoNumber:"AMS"}},skipStartupTypeset:true};loadjs(options.MathJaxURL)}if(options.renderOnLoad){window.onload=texme.renderPage}window.texme=texme}else{commonmark=require("commonmark");module.exports=texme}};texme.main()})();
